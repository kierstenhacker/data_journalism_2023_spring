---
title: "Data Analysis Project"
names: "Kiersten Hacker and Sherwin-Nestor Esguerra"
date: "4-11-2023"
output: html_notebook
---

This notebook will contain the code needed to execute our data analysis project and answer the questions we would like to ask of the Spotify and YouTube data from Kaggle.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load the libraries
```{r}
library(tidyverse)
library(lubridate)
library(janitor)
```

### Load and clean data
```{r}
spotify_youtube <- read_csv("data/Spotify_Youtube.csv") %>%
clean_names() %>%
rename(number = x1) %>%
  select(-c(number)) %>%
mutate(duration_secs = duration_ms/1000, duration_mins = duration_ms/60000)

glimpse(spotify_youtube)


```

### Basic exploratory analysis
** The dataset has 20,718 rows and 28 columns. There are some NA values within the YouTube data which could serve as a limitation. Similarly, within the YouTube description values, some of the descriptions have emojis or other characters and symbols that could be difficult to work with. Another limitation could arise with the values in the instrumentalness column since they include negative exponents which could also be difficult to work with for different analysis calculations. The original source of the data defines the columns well, otherwise we may make them more complicated. Since the data includes artists whose music is on Spotify but probably not every artist in the world, we would not be able to make assumptions about the music industry as a whole. Another limitation we can notice is that some of the songs that fall under an artist's most popular songs are feautres of said artist on another song. This can be kind of confusing, but we might be able to work around it using filters once we start more analysis. However, this data is also helpful for answering our question about how collaborations affect an artist's popularity. One code we would need to make note of is 'key,' which denotes pitch notation but we need to find a way to make it easily apparent what the pitch is rather than just seeing a number. There could also be issues with repeat songs when songs are on more than one album, although sometimes it will be the same song but a slightly different rendition.

##Questions
Question 1: Which attributes, such as danceability, energy, loudness, etc., tend to have a correlation with the most streamed songs?

Analysis: After using code to select the variables we wanted to work with, we found the correlation coefficient for each song attribute in relation to the number of streams for each song. After finding the correlation coefficients, we calculated the mean among the coefficients for each attribute to average it out. After that, we looked for the maximum value among all the means, and found that danceability and streams had the highest positive correlation coefficient of about 0.073. There were some previous errors due to some values being NA, but using the filter for complete cases got rid of them, and the data we did use was so large that it provided a general idea of which attribute had the greatest correlation to number of streams.

```{r}
attribute_correlate_stream <- spotify_youtube %>% 
  select(danceability, energy, key, loudness, speechiness, acousticness, instrumentalness, liveness, valence, tempo, stream) %>% 
  filter(complete.cases(.)) %>%
## find the correlation coefficient between each attribute and number of spotify streams 
   mutate(
    dance_cor = cor(danceability, stream),
    energy_cor = cor(energy, stream),
    key_cor = cor(key, stream),
    speech_cor = cor(speechiness, stream),
    acoustic_cor = cor(acousticness, stream),
    instrumental_cor = cor(instrumentalness, stream),
    live_cor = cor(liveness, stream),
    valence_cor = cor(valence, stream),
    tempo_cor = cor(tempo, stream)
  ) %>% 
## find the mean correlation coefficient for each attribute
  summarise(
    mean_dance_cor = mean(dance_cor),
    mean_energy_cor = mean(energy_cor),
    mean_key_cor = mean(key_cor),
    mean_speech_cor = mean(speech_cor),
    mean_acoustic_cor = mean(acoustic_cor),
    mean_instrumental_cor = mean(instrumental_cor),
    mean_live_cor = mean(live_cor),
    mean_valence_cor = mean(valence_cor),
    mean_tempo_cor = mean(tempo_cor)
  )
##output the highest value among the mean coefficients
max_value <- apply(attribute_correlate_stream, 1, max)
  
```

Question 2: Does higher engagement on YouTube videos lead to more streams of the song from the video on Spotify? Is there a relationship that exists between social engagement and streams?

Analysis: In order to find and map out the correlation between Youtube video views and Spotify streams, we first grouped the data by artist and then summarised the data by the sum of views and sum of streams for each artist. After that, we plotted the data into a scatter plot with a line of best fit, which shows that there is a slight positive correlation between number of views on Youtube and number of streams on Spotify. This means that it can be generally true that as one value increases, so does the other. While doing this, we divided the totals by 1,000,000 because the numbers would have been to large to easily grasp. 

```{r}
##code to find the total number of views and streams (divided by 1,000,000 because numbers were too large to work with)
streams_views <- spotify_youtube %>% 
  select(artist, track, stream, views) %>% 
  mutate(difference = abs(stream-views)) %>% 
  group_by(artist) %>% 
  summarise(
    total_views = sum(views)/1000000,
    total_streams = sum(stream)/1000000,
  )
##create a scatterplot with line of best fit
streams_views %>% 
  ggplot(aes(x=total_streams, y=total_views))+
  geom_point(size=2)+
  theme_minimal()+
  geom_smooth(method = "lm")+
  labs(
    title = "Correlation between an artist's Spotify Streams and Youtube Views",
    x = "Number of Streams on Spotify",
    y = "Number of Views on Youtube"
  )

##what was happening when that wasn't the case, who was successful on spotify and then not youtube
```

Question 3: How many videos with a high number of streams are coming from licensed content?

Analysis: 

```{r}
youtube_high_views <- spotify_youtube %>%
  filter(views > 500000000)

youtube_high_views %>%
  group_by(artist) %>%
  summarise (
    count_licensed = n()
  ) %>%
  arrange(desc(count_licensed))

youtube_high_views %>%
  filter(licensed == FALSE) 

youtube_high_views %>%
  group_by(channel, licensed) %>%
  summarize(total_views = sum(views)) %>% 
  pivot_wider(names_from = licensed, values_from = total_views)

youtube_high_views %>%
  group_by(channel, official_video) %>%
  summarize(total_views = sum(views)) %>% 
  pivot_wider(names_from = official_video, values_from = total_views) %>% 
  filter(`FALSE` > 0)

##how to get totals for licensed and unlicensed? play around with view numbers
##group by licensed column and then used pivot wider, take the values and make total columns for each 
```

Question 4: How do collaborations or features on a song affect its popularity on Spotify and Youtube? What are the most popular collaborations?

Analysis:

```{r}
song_features <- spotify_youtube %>%
  filter(str_detect(track, 'feat.'))

song_features %>%
  group_by(artist, stream) %>%
  arrange(desc(stream))

spotify_youtube %>%
  group_by(artist) %>%
  filter(str_detect(track, 'feat.')) %>%
  arrange(desc(stream))

spotify_youtube %>%
  group_by(artist) %>%
  filter(!str_detect(track,'feat.')) %>%
  arrange(desc(stream))

spotify_youtube %>%
  group_by(artist) %>%
  summarize(total_stream = sum(stream)) %>% 
  pivot_wider(names_from = track, values_from = total_stream) %>%
  filter(str_detect(track,'feat.'))
  


##How to count how many features an artist has, issue of repeats where the same song is listed under more than one artist (Mackelmore and Ryan Lewis)
##are mackelmore collaborations more popular than just himself, try to see who collaboraters are for at least one artist
##average views for artists by themselves and then artist views with their collaborative work, filter for featured and then filter for not featured
```

